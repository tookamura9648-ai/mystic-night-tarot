<!DOCTYPE html>
seeBtn.addEventListener('click', ()=>{
if(chosenIndex==null || !choice) return;
const { card, poseText, scores } = compute();


// カード面をセットしてアニメーション
frontFace.innerHTML = '';
backFace.querySelector('#cardEmoji').textContent = card.emoji;
cardTitle.textContent = card.name;
cardPose.textContent = poseText;


revealCard.classList.remove('flipped');
setTimeout(()=>{ revealCard.classList.add('flipped'); }, 60);


// バーの更新
bars.think.style.width = scores.think+'%'; pcts.think.textContent = scores.think+'%';
bars.feel.style.width = scores.feel+'%'; pcts.feel.textContent = scores.feel+'%';
bars.act.style.width = scores.act+'%'; pcts.act.textContent = scores.act+'%';
bars.intui.style.width = scores.intui+'%'; pcts.intui.textContent = scores.intui+'%';


// テキスト
resultText.textContent = buildText(card, poseText, scores);


// セクション表示切替
step3.hidden = false; step3.scrollIntoView({behavior:'smooth', block:'start'});
});


reselectBtn.addEventListener('click', ()=>{ setupGrid(); window.scrollTo({top:0, behavior:'smooth'}); });
againBtn.addEventListener('click', ()=>{ setupGrid(); window.scrollTo({top:0, behavior:'smooth'}); });


// 共有
shareBtn.addEventListener('click', async (e)=>{
e.preventDefault();
const text = `Mystic Night Tarotで心理バランスを診断しました。\n${resultText.textContent}`;
if(navigator.share){
try{ await navigator.share({ title: '心理バランス診断', text, url: location.href }); }catch(err){}
}else{
navigator.clipboard.writeText(text).then(()=>{
shareBtn.textContent = 'コピーしました'; setTimeout(()=>shareBtn.textContent='結果をシェア', 1400);
});
}
});


// 相談リンク（任意で差し替え）
consultBtn.addEventListener('click', (e)=>{
if(consultBtn.getAttribute('href')==='#'){
e.preventDefault();
alert('「詳しい鑑定を依頼」リンクは、あなたのLINE公式・予約フォームURLに差し替えてください。');
}
});


// 起動
setupGrid();
</script>
</body>

</html>
